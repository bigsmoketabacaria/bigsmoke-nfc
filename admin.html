<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin | Big Smoke</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#000;
  color:#fff;
  font-family:Montserrat;
  padding:20px;
}
input, button {
  padding:10px;
  margin:5px 0;
  width:100%;
}
button {
  background:#2ecc71;
  border:none;
  font-weight:700;
}
</style>
</head>
<body>

<h2>üõ†Ô∏è Admin Big Smoke</h2>

<input id="playerId" placeholder="Player ID">
<input id="valor" type="number" placeholder="Valor da compra">
<input id="descricao" placeholder="Descri√ß√£o">

<button onclick="registrar()">Registrar Compra</button>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDSFd-aLgogUqsRAxne5avvAIiYF6cUFKE",
  authDomain: "bigsmoke-nfc.firebaseapp.com",
  projectId: "bigsmoke-nfc"
});

const db = firebase.firestore();

function registrar() {
  const id = playerId.value;
  const valor = Number(valor.value);
  const descricao = descricao.value;

  const respeito = Math.floor(valor);

  const ref = db.collection("players").doc(id);

  ref.get().then(doc => {
    if (!doc.exists) return alert("Player n√£o encontrado");

    const p = doc.data();

    ref.update({
      respeito: (p.respeito || 0) + respeito,
      comprasTotal: (p.comprasTotal || 0) + valor
    });

    ref.collection("historico").add({
      tipo: "compra",
      valor,
      respeitoGanho: respeito,
      descricao,
      data: new Date()
    });

    alert("Compra registrada com sucesso");
  });
}
</script>

</body>
</html>
