<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin | Big Smoke</title>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#000;
  color:#fff;
  font-family:Montserrat;
  padding:20px;
  max-width:420px;
  margin:auto;
}
h1 {
  font-family:Bebas Neue;
  letter-spacing:2px;
}
section {
  border:1px solid #222;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
}
input, button {
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:none;
}
button {
  background:#2ecc71;
  font-weight:700;
  cursor:pointer;
}
button.alt {
  background:#f1c40f;
  color:#000;
}
button.danger {
  background:#e74c3c;
}
.log {
  font-size:13px;
  opacity:.85;
}
</style>
</head>

<body>

<h1>ğŸ› ï¸ ADMIN BIG SMOKE</h1>

<section>
  <h3>ğŸ¯ IdentificaÃ§Ã£o do Player</h3>
  <input id="playerId" placeholder="Player ID (obrigatÃ³rio)">
</section>

<section>
  <h3>ğŸ’° Registrar Compra</h3>
  <input id="valorCompra" type="number" placeholder="Valor da compra (R$)">
  <input id="descricaoCompra" placeholder="DescriÃ§Ã£o (opcional)">
  <button onclick="registrarCompra()">Registrar Compra</button>
</section>

<section>
  <h3>â• Ajustes Manuais</h3>
  <input id="xpManual" type="number" placeholder="Adicionar respeito manual">
  <button class="alt" onclick="addRespeito()">Adicionar Respeito</button>

  <button class="danger" onclick="resetRespeito()">Resetar Respeito</button>
</section>

<section>
  <h3>ğŸ“… Check-in Manual</h3>
  <button onclick="checkin()">Registrar Check-in</button>
</section>

<section>
  <h3>ğŸ“œ Log</h3>
  <div class="log" id="log">Aguardando aÃ§Ãµesâ€¦</div>
</section>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDSFd-aLgogUqsRAxne5avvAIiYF6cUFKE",
  authDomain: "bigsmoke-nfc.firebaseapp.com",
  projectId: "bigsmoke-nfc"
});

const db = firebase.firestore();
const log = msg => document.getElementById("log").innerText = msg;

function getPlayerRef() {
  const id = document.getElementById("playerId").value.trim();
  if (!id) throw "Informe o Player ID";
  return db.collection("players").doc(id);
}

/* ğŸ’° COMPRA */
async function registrarCompra() {
  try {
    const ref = getPlayerRef();
    const valor = Number(valorCompra.value);
    if (!valor || valor <= 0) throw "Valor invÃ¡lido";

    const desc = descricaoCompra.value || "Compra na Big Smoke";
    const snap = await ref.get();
    if (!snap.exists) throw "Player nÃ£o encontrado";

    const p = snap.data();
    const respeito = Math.floor(valor);

    await ref.update({
      respeito: (p.respeito || 0) + respeito,
      comprasTotal: (p.comprasTotal || 0) + valor
    });

    await ref.collection("historico").add({
      tipo: "compra",
      valor,
      respeitoGanho: respeito,
      descricao: desc,
      data: new Date()
    });

    log("âœ” Compra registrada com sucesso");
  } catch (e) {
    log("âŒ " + e);
  }
}

/* â• RESPEITO MANUAL */
async function addRespeito() {
  try {
    const ref = getPlayerRef();
    const xp = Number(xpManual.value);
    if (!xp) throw "Valor invÃ¡lido";

    const snap = await ref.get();
    const p = snap.data();

    await ref.update({ respeito: (p.respeito || 0) + xp });

    await ref.collection("historico").add({
      tipo: "ajuste",
      respeitoGanho: xp,
      data: new Date()
    });

    log("âœ” Respeito adicionado");
  } catch (e) {
    log("âŒ " + e);
  }
}

/* ğŸ” RESET */
async function resetRespeito() {
  try {
    const ref = getPlayerRef();
    await ref.update({ respeito: 0, rank: 1 });
    log("âš  Respeito resetado");
  } catch (e) {
    log("âŒ " + e);
  }
}

/* ğŸ“… CHECK-IN */
async function checkin() {
  try {
    const ref = getPlayerRef();
    const hoje = new Date().toISOString().split("T")[0];

    await ref.collection("historico").add({
      tipo: "checkin",
      data: hoje
    });

    log("âœ” Check-in registrado");
  } catch (e) {
    log("âŒ " + e);
  }
}
</script>

</body>
</html>
